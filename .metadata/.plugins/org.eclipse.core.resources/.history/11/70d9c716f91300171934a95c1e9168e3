package multithreading

import java.util.concurrent.Executors;
import java.util.concurrent.Callable;

object MultiExecutors {
  
  def main(args: Array[String]): Unit = {
    calcFibWithExecutor
    //calcFibWithParCollection
  }
  
  def fib(n: Int): Int = {
    if (n<2) 1
    else fib(n-1)+fib(n-2)
  }
  
  /*
   * This is an example of calculating a Fibonaci with parallel collections
   */
  def calcFibWithParCollection {
    val values  = for (i <- (30 to 15 by -1).par ) yield {
      val r = fib(i)
      println("Calc: " +r)
    }
    values.foreach(println)
  }
  
  /*
   * This is an example of calculating a fibonaci with an executor using 8 threads
   */
  def calcFibWithExecutor {
    val es = Executors.newFixedThreadPool(8)
    val futures = for (i <- 30 to 15 by -1) yield {
      es.submit(new Callable[Int] {
        def call: Int = {
          val r = fib(i)
          println("Calc : " +r)
          r
        }
      })
    }
    futures.foreach(f=> println(f.get()))
    es.shutdown()
  }
  
}